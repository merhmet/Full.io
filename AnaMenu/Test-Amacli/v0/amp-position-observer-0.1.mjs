;
(self.AMP=self.AMP||[]).push({m:1,v:"2405022220000",n:"amp-position-observer",ev:"0.1",l:!0,f:function(t,i){(()=>{var{isArray:i}=Array;function s(t,i){const s=[];let n=0;for(let h=0;h<t.length;h++){const r=t[h];i(r,h,t)?s.push(r):(n<h&&(t[n]=r),n++)}return n<t.length&&(t.length=n),s}var{hasOwnProperty:n,toString:h}=Object.prototype;function r(t){return 1==(null==(i=t)?void 0:i.nodeType)?t.tagName.toLowerCase()+(t.id?`#${t.id}`:""):t;var i}function e(t,i,n,h,e,o,l,u,c,a,f){return function(t,i,n="Assertion failed",h){var e,o;if(i)return i;t&&-1==n.indexOf(t)&&(n+=t);let l=3;const u=n.split("%s");let c=u.shift();const a=[c];for(;u.length;){const t=arguments[l++],i=u.shift();c+=r(t)+i,a.push(t,i.trim())}const f=new Error(c);throw f.messageArray=s(a,(t=>""!==t)),null===(e=(o=self).__AMP_REPORT_ERROR)||void 0===e||e.call(o,f),f}("​​​",t,i,n,h,e,o,l,u,c,a,f)}function o(t){return e(/^\d+(\.\d+)?(px|em|rem|vh|vw|vmin|vmax|cm|mm|q|in|pc|pt)$/.test(null!=t?t:""),"Invalid length value: %s",t),t}var l="inside",u="bottom";function c(t,i,s,n){return{left:t,top:i,width:s,height:n,bottom:i+n,right:t+s,x:t,y:i}}function a(t,i){return t.top<i.top?"top":t.bottom>i.bottom?u:l}function f(t,i){return!(!t||!i)&&t.left==i.left&&t.top==i.top&&t.width==i.width&&t.height==i.height}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var _=self.__AMP_LOG;function v(t,i){throw new Error("failed to call initLogConstructor")}function A(t){return _.user||(_.user=P()),function(t,i){return i&&i.ownerDocument.defaultView!=t}(_.user.win,t)?_.userForEmbed||(_.userForEmbed=P()):_.user}function P(t){return v()}function d(t,i,s,n,h,r,e,o,l,u,c){return t}function p(t,i,s,n,h,r,e,o,l,u,c){return A().assert(t,i,s,n,h,r,e,o,l,u,c)}function m(t,i){return b(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),i)}function R(t,i){return b(M(E(t)),i)}function E(t){return t.nodeType?(s=t,i=(s.ownerDocument||s).defaultView,m(i,"ampdoc")).getAmpDoc(t):t;var i,s}function M(t){const i=E(t);return i.isSingleDoc()?i.win:i}function b(t,i){d(V(t,i));const s=I(t)[i];return s.obj||(d(s.ctor),d(s.context),s.obj=new s.ctor(s.context),d(s.obj),s.context=null,s.resolve&&s.resolve(s.obj)),s.obj}function I(t){let i=t.__AMP_SERVICES;return i||(i=t.__AMP_SERVICES={}),i}function V(t,i){const s=t.__AMP_SERVICES&&t.__AMP_SERVICES[i];return!(!s||!s.ctor)}var T=t=>R(t,"viewport");function g(t){!function(t,i,s,n){const h=E(t),r=M(h);!function(t,i,s,n,h,r){const e=I(t);let o=e[s];o||(o=e[s]={obj:null,promise:null,resolve:null,reject:null,context:null,ctor:null,sharedInstance:!1}),o.ctor||(o.ctor=n,o.context=i,o.sharedInstance=!1,o.resolve&&b(t,s))}(r,h,i,class{constructor(t){this.Ni=t,this.i=t.win,this.R_=[],this.ar=m(this.i,"vsync"),this.Uu=T(t),this.E_=[],this.M_=!1,this.V_=!1,this.x_=!1,this.S_=function(t,i,s){let n=0,h=0,r=null;function e(){n=0;const o=s-(t.Date.now()-h);var l;o>0?n=t.setTimeout(e,o):(l=r,r=null,i.apply(null,l))}return function(...i){h=t.Date.now(),r=i,n||(n=t.setTimeout(e,s))}}(this.i,(()=>{this.M_=!1}),500)}observe(t,i,s){const n=new class{constructor(t,i,s,n){this.element=i,this.Ie=n,this.fidelity=s,this.turn=0==s?Math.floor(4*Math.random()):0,this.F_=null,this.Uu=T(t)}Ee(t){const i=this.F_;if(i&&f(i.positionRect,t.positionRect)&&f(i.viewportRect,t.viewportRect))return;d(t.positionRect);const s=t.positionRect;var n,h;t.relativePos=a(s,t.viewportRect),n=s,h=t.viewportRect,n.top<=h.bottom&&h.top<=n.bottom&&n.left<=h.right&&h.left<=n.right?(this.F_=t,this.Ie(t)):this.F_&&(this.F_=null,t.positionRect=null,this.Ie(t))}update(t){if(!t){if(0!=this.turn)return void this.turn--;0==this.fidelity&&(this.turn=4)}const i=this.Uu.getSize(),s=c(0,0,i.width,i.height);this.Uu.getClientRectAsync(this.element).then((t=>{this.Ee({positionRect:t,viewportRect:s,relativePos:null})}))}}(this.Ni,t,i,s);return this.R_.push(n),this.x_||this.C_(),n.update(),()=>{for(let t=0;t<this.R_.length;t++)if(this.R_[t]==n)return void this.k_(t)}}unobserve(t){for(let i=0;i<this.R_.length;i++)if(this.R_[i].element==t)return void this.k_(i);(_.dev||(_.dev=v())).error("POSITION_OBSERVER","cannot unobserve unobserved element")}k_(t){this.R_.splice(t,1),0==this.R_.length&&this.z_()}C_(){this.x_=!0,this.E_.push(this.Uu.onScroll((()=>{this.q_()}))),this.E_.push(this.Uu.onResize((()=>{this.H_()})))}z_(){for(this.x_=!1;this.E_.length;)this.E_.pop()()}updateAllEntries(t){for(let i=0;i<this.R_.length;i++)this.R_[i].update(t)}q_(){this.S_(),this.M_=!0,this.V_||this.B_()}H_(){this.updateAllEntries(!0)}B_(){this.updateAllEntries(),this.V_=!0,this.M_?this.ar.measure((()=>{this.B_()})):this.V_=!1}})}(t,"position-observer")}function w(t,i,s,n){const h={detail:s};return Object.assign(h,n),new t.CustomEvent(i,h)}var x="amp-position-observer",y=class extends t.BaseElement{constructor(t){super(t),this.tc=null,this.Mt=null,this.Uu=null,this.rs=!1,this.D_=0,this.L_=0,this.U_="0",this.W_="0",this.G_=0,this.J_=0,this.Tt=null,this.K_=null,this.Q_=null,this.X_=0,this.Y_=0,this.Z_=!1,this.Pv=!1}buildCallback(){this.getAmpDoc().whenFirstVisible().then(this.Au.bind(this)),this.Z_=this.element.hasAttribute("once")}Au(){this.Rv(),this.tc=function(t,i){const s=M(E(t));return V(s,i)?b(s,i):null}(this.element,"action"),this.Uu=T(this.element),this.Ev(),this.getAmpDoc().whenReady().then((()=>{const t=this.Mv();this.Mt.observe(t,1,this.Vv.bind(this))}))}Tv(){const t=w(this.win,`${x}.enter`,{});this.tc.trigger(this.element,"enter",t,1)}xv(){const t=w(this.win,`${x}.exit`,{});this.tc.trigger(this.element,"exit",t,1)}Ov(){const t=this.Uu.getScrollTop(),i={"start-scroll-offset":t,"end-scroll-offset":t+this.Y_,"initial-inview-percent":this.X_},s=w(this.win,`${x}.scroll`,{"percent":this.X_,"positionObserverData":i});this.tc.trigger(this.element,"scroll",s,1)}Vv(t){if(this.Z_&&this.Pv)return;const i=this.rs,s=this.Tt&&this.Tt.height;this.Sv(t),this.Tt=t.viewportRect,s!=t.viewportRect.height&&this.$v();const n=this.Fv(t.viewportRect),{positionRect:h}=t;let r;h?(r=a(h,n),this.th(h,n,r)):(this.rs=!1,r=t.relativePos),i&&!this.rs&&(this.X_=r==u?0:1,this.Ov(),this.xv(),this.Pv=!0),!i&&this.rs&&this.Tv(),this.rs&&(this.jv(h,n),this.Ov())}th(t,i,s){if(s==l)return void(this.rs=!0);const n="top"==s?this.D_:this.L_,h=t.height*n;this.rs=s==u?t.top<=i.bottom-h:t.bottom>=i.top+h}jv(t,i){if(!t)return;const s=t.height*this.L_+t.height*this.D_,n=i.height+t.height-s,h=Math.abs(t.top-this.G_-(i.height-t.height*this.L_));this.X_=h/n,this.Y_=n-h}Rv(){const t=this.element.getAttribute("intersection-ratios");if(t){const i=t.trim().split(" ");this.D_=this.Cv(i[0]),this.L_=this.D_,i[1]&&(this.L_=this.Cv(i[1]))}const i=this.element.getAttribute("viewport-margins");if(i){const t=i.trim().split(" ");this.U_=t[0],this.W_=this.U_,t[1]&&(this.W_=t[1])}this.K_=this.element.getAttribute("target")}Mv(){let t;return t=this.K_?A().assertElement(this.win.document.getElementById(this.K_),"No element found with id:"+this.K_):this.element.parentNode,this.win.document.body===t&&(t=this.win.document.documentElement),t}kv(t){var i;const s=function(t){o(t);const i=/[a-z]+/i.exec(null!=t?t:"");return e(i,"Failed to read units from %s",t),i[0]}(t=o("number"==typeof(i=t)?i+"px":i&&/^\d+(\.\d+)?(px|em|rem|vh|vw|vmin|vmax|cm|mm|q|in|pc|pt)?$/.test(i)?/^\d+(\.\d+)?$/.test(i)?i+"px":i:void 0));let n=function(t){const i=parseFloat(t);return"number"==typeof(s=i)&&isFinite(s)?i:void 0;var s}(t);return n?(p("px"==s||"vh"==s,"Only pixel or vh are valid as units for exclusion margins: "+t),"vh"==s&&(n=n/100*this.Tt.height),n):0}Cv(t){const i=parseFloat(t);return p(i>=0&&i<=1,"Ratios must be a decimal between 0 and 1: "+t),i}$v(){d(this.Tt),d(this.W_),d(this.U_),this.G_=this.kv(this.U_),this.J_=this.kv(this.W_)}Fv(t){return d(t),c(t.left,t.top+this.G_,t.width,t.height-this.J_-this.G_)}Sv(t){this.Q_||(this.Q_=t.viewportRect.height);const i=this.Q_-t.viewportRect.height;let s=0;Math.abs(i)<150?s=i:this.Q_=null,t.viewportRect=c(t.viewportRect.left,t.viewportRect.top,t.viewportRect.width,t.viewportRect.height+s)}Ev(){this.Mt||(g(this.getAmpDoc()),this.Mt=R(this.element,"position-observer"))}zv(){if(this.Mt){const t=this.Mv();this.Mt.unobserve(t),this.Mt=null}}};t.registerElement(x,y)})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-position-observer-0.1.mjs.map